# Guide: Building Your Capacitor App in the Cloud with Ionic Appflow

This guide provides a complete, step-by-step process for setting up Ionic Appflow to build your native mobile apps (iOS and Android) in the cloud. This workflow removes the need to install and maintain complex local development environments like Xcode and Android Studio.

---

### **Prerequisites**

Before you begin, ensure you have the following:

1.  **A Git Repository Host Account:** A free account on [GitHub](https://github.com) (recommended), GitLab, or Bitbucket.
2.  **An Ionic Appflow Account:** A free account is sufficient to get started. You can sign up at the [Ionic Appflow website](https://ionic.io/appflow).

---

### **Phase 1: Prepare Your Local Project for Git**

Your project's code must be stored in a cloud-based Git repository for Appflow to access it.

**1. Initialize a Git Repository (if you haven't already)**

Open your terminal and navigate to your project's root directory.

```bash
# Navigate to your project root
cd /Users/sameerhoda/alt_projects/runna/mynextpr_v5

# Initialize a new Git repository on the 'main' branch
git init -b main

# Add all your current files to be tracked by Git
git add .

# Create your first commit to save the project's state
git commit -m "Initial commit of the Runna project"
```

**2. Create a New Repository on GitHub**

Go to [GitHub.com](https://github.com) and create a **new, empty repository**. Do not initialize it with a `README` or `.gitignore` file from the GitHub interface, as you will add those from your local project.

**3. Link Your Local Project to the GitHub Repository**

GitHub will provide you with commands to "push an existing repository from the command line." Copy and run those commands in your terminal. They will look similar to this:

```bash
# Replace the URL with the one from YOUR new GitHub repository
git remote add origin https://github.com/your-username/your-repo-name.git

# Push your local 'main' branch to the remote 'origin' repository on GitHub
git push -u origin main
```

**4. Create a `.gitignore` File**

This is a critical step to prevent unnecessary files from being uploaded to your repository, which can slow down builds.

*   Create a new file named `.gitignore` in your project's root directory (`/Users/sameerhoda/alt_projects/runna/mynextpr_v5/.gitignore`).
*   Paste the following content into the `.gitignore` file:

    ```
    # Dependencies
    /node_modules
    /plan-my-run/node_modules
    /backend/node_modules

    # Build output from local builds
    /plan-my-run/dist
    /plan-my-run/build

    # Native platform folders (these are generated by the cloud build service)
    /plan-my-run/android
    /plan-my-run/ios

    # Environment variables (NEVER commit these)
    .env
    .env.local
    backend/.env

    # Logs and temporary files
    npm-debug.log
    backend/temp_data
    backend/runna.db

    # macOS specific
    .DS_Store
    ```

*   Save the file and commit it to your repository:

    ```bash
    # Add the new .gitignore file
    git add .gitignore

    # Commit the change
    git commit -m "Add .gitignore file"

    # Push the commit to GitHub
    git push origin main
    ```

---

### **Phase 2: Set Up Your App in Ionic Appflow**

**1. Sign Up and Log In**

Go to the [Ionic Appflow website](https://ionic.io/appflow) and sign into your account.

**2. Create a New App in the Dashboard**

*   From the main dashboard, click on **Apps** in the navigation, then click the **New App** button.
*   Select **Create new app**.
*   Give your app a name (e.g., "Runna").
*   Choose **Capacitor** as your mobile framework.

**3. Connect Appflow to Your Git Repository**

*   You will be prompted to connect to a Git host. Choose **GitHub** (or your preferred provider).
*   Follow the on-screen instructions to authorize Appflow to access your GitHub account.
*   Select the repository you created in Phase 1 (e.g., `your-username/runna-mobile-app`).

Appflow is now linked to your code. It will automatically detect new commits as you push them.

---

### **Phase 3: Run Your First Cloud Build**

This is where you offload the compilation work to the cloud.

**1. Push a Code Change to Trigger a Build**

To see the process in action, make a small, visible change to your code. For example, you could edit the title in `plan-my-run/index.html`.

*   Commit and push this change to your GitHub repository:

    ```bash
    # Add all changed files
    git add .

    # Commit the change with a descriptive message
    git commit -m "Test: Update title for first Appflow build"

    # Push the commit to GitHub
    git push origin main
    ```

**2. Start a New Build in the Appflow Dashboard**

*   Go to your Appflow dashboard and open your "Runna" app.
*   Navigate to the **Build > Commits** tab on the left. You should see your latest commit at the top of the list.
*   Click the **Build** button (looks like a hammer icon) next to that commit.

**3. Configure and Run the Build**

*   A "Start new build" modal will appear.
*   **Target Platform:** Select **Android**.
*   **Build Type:** Select **Package Build**. This creates an installable `.apk` file for testing.
*   Click the **Build** button at the bottom of the modal.

**4. Monitor the Build Process**

You will be taken to a real-time log screen. Appflow is now performing all the steps you were trying to do locally:
1.  Provisioning a cloud machine with the correct environment.
2.  Cloning your Git repository.
3.  Running `npm install` for all dependencies.
4.  Running `npm run build` to create your web assets.
5.  Running `npx cap sync` to copy assets into the native project.
6.  Compiling the native Android project to produce the final `.apk` file.

This process will take several minutes. Wait for the status to show "Success".

---

### **Phase 4: Download and Install Your App**

**1. Download the App File (`.apk`)**

*   On the successful build page, you will see a section with the build artifacts.
*   Click the **download button** next to the `app-debug.apk` file.

**2. Install on an Android Device**

*   Transfer the downloaded `.apk` file to your Android phone (using a USB cable, Google Drive, email, etc.).
*   On your phone, open the file. You may need to grant permission to "Install from unknown sources" in your phone's security settings.
*   Follow the prompts to install the app.

You have now successfully built and installed your Capacitor app using a cloud-based workflow, with no native tooling required on your local machine.
